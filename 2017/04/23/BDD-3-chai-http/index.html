
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Devlog">
    <title>[TDD] 3. Chai-http 사용하여 REST API Test하기 - Devlog</title>
    <meta name="author" content="Jbee">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/feed.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jbee","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"\n[TDD] 3. Chai-http 사용하여 REST API Test하기&gt;Mocha - Getting started&gt;&gt;Chai - Getting started&gt;\n이번 포스팅에서는 chai-http라는 module을 사용해서 REST API를 테스트하는 코드를 작성해보겠습니다.\n테스트에 집중하기 위해 요청을 받을 서버는 json-server라는 모듈을 사용하여 구축하겠습니다. json형태로 데이터를 생성하고 요청을 받을 수 있는 임시 서버입니다. 데이터베이스를 따로 구축하지 않아도 CRUD와 같은 기본적인 API를 제공해주는 모듈입니다. 포스팅에서 다루는 내용보다 더 자세한 내용은 해당 링크를 참조하시면 되겠습니다.\n테스트 환경 구축하기우선 chai-http를 설치합니다.1$ yarn add chai-http\n그리고 서버로 사용할 json-server를 설치합니다.1$ yarn global add json-server\n그런 다음 src 디렉토리(작업하고자 하는 디렉토리)로 이동하여 다음 명령어를 실행해줍니다.1$ json-server --watch db.json\n위 명령어를 실행하게 되면 db.json 파일을 생성하게 되고 해당 .json파일에 기본적인 데이터가 들어가있습니다. json-server는 기본적으로 3000번 포트를 사용합니다. localhost:3000에 접속해보면 어떠한 데이터가 들어가있는지를 간단한 웹 페이지를 통해서도 확인하실 수 있습니다.1234\\&#123;^_^&#125;/ hi!Loading db.jsonDone\nconsole에는 귀여운 이모티콘이 환영을 해주네요 :)\n보다 customized한 서버를 사용하시고 싶은 경우에는 다음과 같은 .js파일을 만들어 사용하실 수 있습니다.server.js12345678910const jsonServer = require('json-server');const server = jsonServer.create();const router = jsonServer.router('db.json');const middlewares = jsonServer.defaults();server.use(middlewares);server.use(router);server.listen(3000, () =&gt; &#123;  console.log('JSON Server is running')&#125;);\n위 파일은 node server.js 명령어로 실행하실 수 있습니다 :) 이번 포스팅에서는 default로 생성되는 임시 서버를 사용하겠습니다.\n.test 파일 작성이제 테스트 코드를 작성할 .test파일을 만들어 보겠습니다.rest.test.js123456const chai = require('chai');const chaiHttp = require('chai-http');const expect = chai.expect;chai.use(chaiHttp);const url = 'http://localhost:3000';\n이전에 설치한 chai와 테스트 환경을 구축할 때 설치한 chai-http를 불러옵니다. 그리고 chai가 chai-http를 use합니다. 이전 포스팅에서 소개해드렸던 expect를 사용하기 위해 준비합니다. 마지막으로 요청을 보낼 서버의 api에서 반복될 url을 상수로 할당해줬습니다.\nRequest TEST본격적인 테스트 코드를 작성할 시간입니다. 우선 server에 요청이 제대로 가는지 확인해보겠습니다.rest.test.js1234567891011describe('Request test', () =&gt; &#123;    it('request to server', done =&gt; &#123;        chai.request(url)            .get('/')            .end((err, res) =&gt; &#123;                expect(err).to.be.null;                expect(res).to.have.status(200);                done();            &#125;);    &#125;);&#125;);\n위 코드는 http://localhost:3000/에 대한 GET 요청이 제대로 동작하는지 테스트하는 코드입니다.해당 url로 request를 보내고 get 방식으로 그 요청을 보냅니다. 요청에 대한 응답을 .end()메소드로 받을 수 있습니다. 이 end() 메소드에는 요청에 대한 응답으로 err와 res를 파라미터로 받는 콜백 함수를 넘겨줍니다.콜백 함수에서는 에러(err)는 null값이어야 하고, http status code는 200이어야 한다는 내용을 담고 있습니다. 모든 조건이 만족되면 done() 함수가 호출되면서 test가 pass하게 됩니다.1$ npm test\n위 명령어로 test를 실행해보겠습니다. 방금 전 json-server를 running한 터미널 창이 아닌 다른 터미널 창에서 실행하셔야 합니다. 요청을 받으러면 서버가 running 중이어야 하니까요 :)test terminal1234REST test  ✓ request to server1 passing (13ms)\n해당 테스트가 잘 pass한 것을 확인하실 수 있습니다.json-server terminal1GET / 200 2.318 ms - -\n그리고 아까 json-server --watch db.json 명령어를 실행한 console에서는 GET요청에 대한 로그를 남깁니다.\nCRUD TESTData Modeling테스트를 위해 db.json에 간단한 데이터를 넣어보겠습니다. 다음과 비슷한 형식으로 바꿔줍니다.db.json12345678910111213141516171819&#123;  \"users\": [    &#123;      \"id\": 1,      \"name\": \"Jbee\",      \"age\": 25    &#125;,    &#123;      \"id\": 2,      \"name\": \"foo\",      \"age\": 20    &#125;,    &#123;      \"id\": 3,      \"name\": \"bar\",      \"age\": 30    &#125;  ]&#125;\nusers라는 배열을 지정해줬습니다. 배열의 요소에는 name과 age를 갖고 있는 json형식의 데이터를 넣어줬습니다. 저장을 하면 --watch옵션을 붙여 실행했기 때문에 변경된 데이터 사항이 자동으로 반영됩니다. localhost:3000의 웹 페이지도 새로고침을 해보면 새로운 데이터가 들어가있는 것을 확인하실 수 있습니다. 이 데이터에는 /users라는 api로 접근이 가능합니다.\nGETdb.json파일에 추가한 users데이터를 가져와 봅시다.rest.test.js123456789101112describe('GET', () =&gt; &#123;  it('fetch all users', done =&gt; &#123;    chai.request(url)        .get('/users')        .end((err, res) =&gt; &#123;            expect(err).to.be.not.ok;            expect(res).to.have.status(200);            expect(res.body).to.be.an('array');            done();    &#125;);  &#125;);&#125;);\n이전의 코드와 매우 유사합니다. res.body에 대한 값을 확인하는 코드가 추가되었습니다. array 형식의 데이터라면 test를 pass시키도록 테스트 코드를 작성했습니다. test가 잘 통과하네요 :)특정 user에 대한 값만 가져오려면 어떻게 해야 할까요?rest.test.js1234567891011121314151617it('fetch one user', done =&gt; &#123;  chai.request(url)      .get('/users')      .query(&#123;id: 1&#125;)      .end((err, res) =&gt; &#123;          expect(err).to.be.null;          expect(res).to.have.status(200);          expect(res.body[0]).to.deep.equal(              &#123;                  id: 1,                  name: \"Jbee\",                  age: 25              &#125;          );          done();      &#125;);&#125;);\n위 예제 코드를 describe 콜백 함수 안에 추가해줍니다. 와 같이 .query()에 해당하는 조건을 넘겨줄 수 있습니다. 응답으로 오는 데이터가 명시한 값과 일치하는지를 테스트 코드로 작성해줬습니다.\nPOSTrest.test.js12345678910111213describe('POST', () =&gt; &#123;  it('add user', done =&gt; &#123;    chai.request(url)        .post('/users')        .send(&#123;id: 4, name: 'react', age: 3&#125;)        .end((err, res) =&gt; &#123;            expect(err).to.be.not.ok;            expect(res).to.have.status(201);            user = res.body;            done();        &#125;);  &#125;);&#125;);\npost()메소드와 send() 메소드를 통해 테스트를 진행할 수 있습니다.\nPUTrest.test.js123456789101112describe('PATCH', () =&gt; &#123;  it('update user', done =&gt; &#123;    chai.request(url)        .patch('/users/2')        .send(&#123;name: 'angular', age: 1&#125;)        .end((err, res) =&gt; &#123;            expect(err).to.be.not.ok;            expect(res).to.have.status(200);            done();        &#125;);  &#125;);&#125;);\npatch()메소드와 send() 메소드를 통해 테스트를 진행할 수 있습니다.\nDELETErest.test.js1234567891011describe('DELETE', () =&gt; &#123;  it('delete user', done =&gt; &#123;    chai.request(url)        .delete('/users/4')        .end((err, res) =&gt; &#123;            expect(err).to.be.not.ok;            expect(res).to.have.status(200);            done();        &#125;);  &#125;);&#125;);\ndelete()메소드를 통해 테스트를 진행할 수 있습니다.\n예제로 사용된 코드는 Github Respository에서 확인하실 수 있습니다.\n[TDD] 3. end\n","dateCreated":"2017-04-23T16:07:57+09:00","dateModified":"2017-05-21T13:42:41+09:00","datePublished":"2017-04-23T16:07:57+09:00","description":"","headline":"[TDD] 3. Chai-http 사용하여 REST API Test하기","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/"},"publisher":{"@type":"Organization","name":"Jbee","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/","keywords":"TDD"}</script>
    <meta name="description" content="[TDD] 3. Chai-http 사용하여 REST API Test하기&amp;gt;Mocha - Getting started&amp;gt;&amp;gt;Chai - Getting started&amp;gt; 이번 포스팅에서는 chai-http라는 module을 사용해서 REST API를 테스트하는 코드를 작성해보겠습니다. 테스트에 집중하기 위해 요청을 받을 서버는 json-serv">
<meta name="keywords" content="TDD">
<meta property="og:type" content="blog">
<meta property="og:title" content="[TDD] 3. Chai-http 사용하여 REST API Test하기">
<meta property="og:url" content="https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/index.html">
<meta property="og:site_name" content="Devlog">
<meta property="og:description" content="[TDD] 3. Chai-http 사용하여 REST API Test하기&amp;gt;Mocha - Getting started&amp;gt;&amp;gt;Chai - Getting started&amp;gt; 이번 포스팅에서는 chai-http라는 module을 사용해서 REST API를 테스트하는 코드를 작성해보겠습니다. 테스트에 집중하기 위해 요청을 받을 서버는 json-serv">
<meta property="og:image" content="https://jaeyeophan.github.io/images/tool_chai.png">
<meta property="og:updated_time" content="2017-05-21T04:42:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[TDD] 3. Chai-http 사용하여 REST API Test하기">
<meta name="twitter:description" content="[TDD] 3. Chai-http 사용하여 REST API Test하기&amp;gt;Mocha - Getting started&amp;gt;&amp;gt;Chai - Getting started&amp;gt; 이번 포스팅에서는 chai-http라는 module을 사용해서 REST API를 테스트하는 코드를 작성해보겠습니다. 테스트에 집중하기 위해 요청을 받을 서버는 json-serv">
<meta name="twitter:image" content="https://jaeyeophan.github.io/images/tool_chai.png">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Devlog</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="Search"
                        >
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://stackoverflow.com/users" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/" target="_blank" rel="noopener" title="Google +">
                    
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/profile/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/mailto"
                            title="Mail"
                        >
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [TDD] 3. Chai-http 사용하여 REST API Test하기
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-04-23T16:07:57+09:00">
	
		    Apr 23, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Tool/">Tool</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p><img src="/images/tool_chai.png" alt=""></p>
<h1 id="TDD-3-Chai-http-사용하여-REST-API-Test하기"><a href="#TDD-3-Chai-http-사용하여-REST-API-Test하기" class="headerlink" title="[TDD] 3. Chai-http 사용하여 REST API Test하기"></a>[TDD] 3. Chai-http 사용하여 REST API Test하기</h1><p><a href="https://jaeyeophan.github.io/2017/04/23/BDD-1-mocha/">&gt;Mocha - Getting started&gt;</a><br><br><a href="https://jaeyeophan.github.io/2017/04/23/BDD-2-chai/">&gt;Chai - Getting started&gt;</a></p>
<p>이번 포스팅에서는 <code>chai-http</code>라는 module을 사용해서 REST API를 테스트하는 코드를 작성해보겠습니다.</p>
<p>테스트에 집중하기 위해 요청을 받을 서버는 <code>json-server</code>라는 모듈을 사용하여 구축하겠습니다. <code>json</code>형태로 데이터를 생성하고 요청을 받을 수 있는 임시 서버입니다. 데이터베이스를 따로 구축하지 않아도 <code>CRUD</code>와 같은 기본적인 API를 제공해주는 모듈입니다. 포스팅에서 다루는 내용보다 더 자세한 내용은 해당 <a href="https://github.com/typicode/json-server" target="_blank" rel="external">링크</a>를 참조하시면 되겠습니다.</p>
<h2 id="테스트-환경-구축하기"><a href="#테스트-환경-구축하기" class="headerlink" title="테스트 환경 구축하기"></a>테스트 환경 구축하기</h2><p>우선 <code>chai-http</code>를 설치합니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ yarn add chai-http</div></pre></td></tr></table></figure></p>
<p>그리고 서버로 사용할 <code>json-server</code>를 설치합니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ yarn global add json-server</div></pre></td></tr></table></figure></p>
<p>그런 다음 <code>src</code> 디렉토리(작업하고자 하는 디렉토리)로 이동하여 다음 명령어를 실행해줍니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ json-server --watch db.json</div></pre></td></tr></table></figure></p>
<p>위 명령어를 실행하게 되면 <code>db.json</code> 파일을 생성하게 되고 해당 <code>.json</code>파일에 기본적인 데이터가 들어가있습니다. <code>json-server</code>는 기본적으로 <code>3000</code>번 포트를 사용합니다. <a href="http://localhost:3000/" target="_blank" rel="external">localhost:3000</a>에 접속해보면 어떠한 데이터가 들어가있는지를 간단한 웹 페이지를 통해서도 확인하실 수 있습니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">\&#123;^_^&#125;/ hi!</div><div class="line"></div><div class="line">Loading db.json</div><div class="line">Done</div></pre></td></tr></table></figure></p>
<p>console에는 귀여운 이모티콘이 환영을 해주네요 :)</p>
<p>보다 customized한 서버를 사용하시고 싶은 경우에는 다음과 같은 <code>.js</code>파일을 만들어 사용하실 수 있습니다.<br><figure class="highlight javascript"><figcaption><span>server.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> jsonServer = <span class="built_in">require</span>(<span class="string">'json-server'</span>);</div><div class="line"><span class="keyword">const</span> server = jsonServer.create();</div><div class="line"><span class="keyword">const</span> router = jsonServer.router(<span class="string">'db.json'</span>);</div><div class="line"><span class="keyword">const</span> middlewares = jsonServer.defaults();</div><div class="line"></div><div class="line">server.use(middlewares);</div><div class="line">server.use(router);</div><div class="line">server.listen(<span class="number">3000</span>, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'JSON Server is running'</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>위 파일은 <code>node server.js</code> 명령어로 실행하실 수 있습니다 :) 이번 포스팅에서는 default로 생성되는 임시 서버를 사용하겠습니다.</p>
<h2 id="test-파일-작성"><a href="#test-파일-작성" class="headerlink" title=".test 파일 작성"></a>.test 파일 작성</h2><p>이제 테스트 코드를 작성할 <code>.test</code>파일을 만들어 보겠습니다.<br><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>);</div><div class="line"><span class="keyword">const</span> chaiHttp = <span class="built_in">require</span>(<span class="string">'chai-http'</span>);</div><div class="line"><span class="keyword">const</span> expect = chai.expect;</div><div class="line">chai.use(chaiHttp);</div><div class="line"></div><div class="line"><span class="keyword">const</span> url = <span class="string">'http://localhost:3000'</span>;</div></pre></td></tr></table></figure></p>
<p>이전에 설치한 <code>chai</code>와 테스트 환경을 구축할 때 설치한 <code>chai-http</code>를 불러옵니다. 그리고 <code>chai</code>가 <code>chai-http</code>를 <code>use</code>합니다. 이전 포스팅에서 소개해드렸던 <code>expect</code>를 사용하기 위해 준비합니다. 마지막으로 요청을 보낼 서버의 api에서 반복될 url을 상수로 할당해줬습니다.</p>
<h2 id="Request-TEST"><a href="#Request-TEST" class="headerlink" title="Request TEST"></a>Request TEST</h2><p>본격적인 테스트 코드를 작성할 시간입니다. 우선 server에 요청이 제대로 가는지 확인해보겠습니다.<br><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'Request test'</span>, () =&gt; &#123;</div><div class="line">    it(<span class="string">'request to server'</span>, done =&gt; &#123;</div><div class="line">        chai.request(url)</div><div class="line">            .get(<span class="string">'/'</span>)</div><div class="line">            .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">                expect(err).to.be.null;</div><div class="line">                expect(res).to.have.status(<span class="number">200</span>);</div><div class="line">                done();</div><div class="line">            &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>위 코드는 <code>http://localhost:3000/</code>에 대한 <code>GET</code> 요청이 제대로 동작하는지 테스트하는 코드입니다.<br>해당 <code>url</code>로 <code>request</code>를 보내고 <code>get</code> 방식으로 그 요청을 보냅니다. 요청에 대한 응답을 <code>.end()</code>메소드로 받을 수 있습니다. 이 <code>end()</code> 메소드에는 요청에 대한 응답으로 <code>err</code>와 <code>res</code>를 파라미터로 받는 콜백 함수를 넘겨줍니다.<br>콜백 함수에서는 에러(<code>err</code>)는 <code>null</code>값이어야 하고, http status code는 <code>200</code>이어야 한다는 내용을 담고 있습니다. 모든 조건이 만족되면 <code>done()</code> 함수가 호출되면서 test가 pass하게 됩니다.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>위 명령어로 test를 실행해보겠습니다. 방금 전 <code>json-server</code>를 running한 터미널 창이 아닌 다른 터미널 창에서 실행하셔야 합니다. 요청을 받으러면 서버가 running 중이어야 하니까요 :)<br><figure class="highlight bash"><figcaption><span>test terminal</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">REST <span class="built_in">test</span></div><div class="line">  ✓ request to server</div><div class="line"></div><div class="line">1 passing (13ms)</div></pre></td></tr></table></figure></p>
<p>해당 테스트가 잘 pass한 것을 확인하실 수 있습니다.<br><figure class="highlight bash"><figcaption><span>json-server terminal</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GET / 200 2.318 ms - -</div></pre></td></tr></table></figure></p>
<p>그리고 아까 <code>json-server --watch db.json</code> 명령어를 실행한 console에서는 GET요청에 대한 로그를 남깁니다.</p>
<h2 id="CRUD-TEST"><a href="#CRUD-TEST" class="headerlink" title="CRUD TEST"></a>CRUD TEST</h2><h3 id="Data-Modeling"><a href="#Data-Modeling" class="headerlink" title="Data Modeling"></a>Data Modeling</h3><p>테스트를 위해 <code>db.json</code>에 간단한 데이터를 넣어보겠습니다. 다음과 비슷한 형식으로 바꿔줍니다.<br><figure class="highlight json"><figcaption><span>db.json</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"users"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">1</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Jbee"</span>,</div><div class="line">      <span class="attr">"age"</span>: <span class="number">25</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">2</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"foo"</span>,</div><div class="line">      <span class="attr">"age"</span>: <span class="number">20</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="number">3</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"bar"</span>,</div><div class="line">      <span class="attr">"age"</span>: <span class="number">30</span></div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>users</code>라는 배열을 지정해줬습니다. 배열의 요소에는 <code>name</code>과 <code>age</code>를 갖고 있는 <code>json</code>형식의 데이터를 넣어줬습니다. 저장을 하면 <code>--watch</code>옵션을 붙여 실행했기 때문에 변경된 데이터 사항이 자동으로 반영됩니다. <code>localhost:3000</code>의 웹 페이지도 새로고침을 해보면 새로운 데이터가 들어가있는 것을 확인하실 수 있습니다. 이 데이터에는 <code>/users</code>라는 api로 접근이 가능합니다.</p>
<h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><p><code>db.json</code>파일에 추가한 <code>users</code>데이터를 가져와 봅시다.<br><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'GET'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'fetch all users'</span>, done =&gt; &#123;</div><div class="line">    chai.request(url)</div><div class="line">        .get(<span class="string">'/users'</span>)</div><div class="line">        .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">            expect(err).to.be.not.ok;</div><div class="line">            expect(res).to.have.status(<span class="number">200</span>);</div><div class="line">            expect(res.body).to.be.an(<span class="string">'array'</span>);</div><div class="line">            done();</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>이전의 코드와 매우 유사합니다. <code>res.body</code>에 대한 값을 확인하는 코드가 추가되었습니다. array 형식의 데이터라면 test를 pass시키도록 테스트 코드를 작성했습니다. test가 잘 통과하네요 :)<br>특정 <code>user</code>에 대한 값만 가져오려면 어떻게 해야 할까요?<br><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'fetch one user'</span>, done =&gt; &#123;</div><div class="line">  chai.request(url)</div><div class="line">      .get(<span class="string">'/users'</span>)</div><div class="line">      .query(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;)</div><div class="line">      .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">          expect(err).to.be.null;</div><div class="line">          expect(res).to.have.status(<span class="number">200</span>);</div><div class="line">          expect(res.body[<span class="number">0</span>]).to.deep.equal(</div><div class="line">              &#123;</div><div class="line">                  <span class="attr">id</span>: <span class="number">1</span>,</div><div class="line">                  <span class="attr">name</span>: <span class="string">"Jbee"</span>,</div><div class="line">                  <span class="attr">age</span>: <span class="number">25</span></div><div class="line">              &#125;</div><div class="line">          );</div><div class="line">          done();</div><div class="line">      &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>위 예제 코드를 describe 콜백 함수 안에 추가해줍니다. 와 같이 <code>.query()</code>에 해당하는 조건을 넘겨줄 수 있습니다. 응답으로 오는 데이터가 명시한 값과 일치하는지를 테스트 코드로 작성해줬습니다.</p>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'POST'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'add user'</span>, done =&gt; &#123;</div><div class="line">    chai.request(url)</div><div class="line">        .post(<span class="string">'/users'</span>)</div><div class="line">        .send(&#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">'react'</span>, <span class="attr">age</span>: <span class="number">3</span>&#125;)</div><div class="line">        .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">            expect(err).to.be.not.ok;</div><div class="line">            expect(res).to.have.status(<span class="number">201</span>);</div><div class="line">            user = res.body;</div><div class="line">            done();</div><div class="line">        &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>post()</code>메소드와 <code>send()</code> 메소드를 통해 테스트를 진행할 수 있습니다.</p>
<h3 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h3><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'PATCH'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'update user'</span>, done =&gt; &#123;</div><div class="line">    chai.request(url)</div><div class="line">        .patch(<span class="string">'/users/2'</span>)</div><div class="line">        .send(&#123;<span class="attr">name</span>: <span class="string">'angular'</span>, <span class="attr">age</span>: <span class="number">1</span>&#125;)</div><div class="line">        .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">            expect(err).to.be.not.ok;</div><div class="line">            expect(res).to.have.status(<span class="number">200</span>);</div><div class="line">            done();</div><div class="line">        &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>patch()</code>메소드와 <code>send()</code> 메소드를 통해 테스트를 진행할 수 있습니다.</p>
<h3 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h3><figure class="highlight javascript"><figcaption><span>rest.test.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'DELETE'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'delete user'</span>, done =&gt; &#123;</div><div class="line">    chai.request(url)</div><div class="line">        .delete(<span class="string">'/users/4'</span>)</div><div class="line">        .end(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</div><div class="line">            expect(err).to.be.not.ok;</div><div class="line">            expect(res).to.have.status(<span class="number">200</span>);</div><div class="line">            done();</div><div class="line">        &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>delete()</code>메소드를 통해 테스트를 진행할 수 있습니다.</p>
<p>예제로 사용된 코드는 <a href="https://github.com/JaeYeopHan/javascript_test_tutorial" target="_blank" rel="external">Github Respository</a>에서 확인하실 수 있습니다.</p>
<p><em>[TDD] 3. end</em></p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/TDD/">TDD</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/BDD-2-chai/" data-tooltip="[TDD] 2. Chai - Getting started" aria-label="PREVIOUS: [TDD] 2. Chai - Getting started">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/TS-1-Basic-Types/" data-tooltip="[TS] 1. Basic Types" aria-label="NEXT: [TS] 1. Basic Types">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Jbee. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/BDD-2-chai/" data-tooltip="[TDD] 2. Chai - Getting started" aria-label="PREVIOUS: [TDD] 2. Chai - Getting started">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/23/TS-1-Basic-Types/" data-tooltip="[TS] 1. Basic Types" aria-label="NEXT: [TS] 1. Basic Types">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/" title="Share on Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/">
                    <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://jaeyeophan.github.io/2017/04/23/BDD-3-chai-http/">
                    <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Jbee</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
